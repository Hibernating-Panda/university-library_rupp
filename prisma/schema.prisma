generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

enum Role {
  ADMIN
  STAFF
  USER
}

enum BookStatus {
  AVAILABLE
  BORROWED
  RESERVED
  MAINTENANCE
}

enum BorrowingStatus {
  BORROWED
  RETURNED
  OVERDUE
  LOST
}

enum ReservationStatus {
  PENDING
  FULFILLED
  CANCELLED
  EXPIRED
}

enum NotificationType {
  DUE_SOON
  OVERDUE
  RESERVATION_AVAILABLE
  FINE_ISSUED
  SYSTEM
}

enum Category {
  English
  Math
  IT
  History
  Engineering
  Sociology
  Psychology
  Chemistry
  Physics
  Biology
}

model User {
  id            String         @id @default(cuid())
  name          String
  email         String         @unique
  password      String
  role          Role           @default(USER)
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  borrowedBooks Borrowing[]    @relation("BorrowedBooks")
  reservations  Reservation[]  @relation("UserReservations")
  notifications Notification[] @relation("UserNotifications")
}

model Book {
  id            String        @id @default(cuid())
  title         String
  author        String
  isbn          String?       @unique
  description   String?
  fileUrl       String
  coverImageUrl String?
  status        BookStatus    @default(AVAILABLE)
  category      String?
  createdAt     DateTime      @default(now())
  quantity      Int           @default(1)
  borrowings    Borrowing[]   @relation("BookBorrowings")
  reservations  Reservation[] @relation("BookReservations")

  @@index([title])
  @@index([author])
}

model Borrowing {
  id          String           @id @default(cuid())
  bookId      String
  userId      String
  borrowedAt  DateTime         @default(now())
  dueDate     DateTime
  returnedAt  DateTime?
  fineAmount  Float            @default(0)
  status      BorrowingStatus  @default(BORROWED)
  isRead      Boolean          @default(false)

  book Book @relation("BookBorrowings", fields: [bookId], references: [id], onDelete: Cascade)
  user User @relation("BorrowedBooks", fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([bookId])
}

model Reservation {
  id          String             @id @default(cuid())
  book        Book               @relation("BookReservations", fields: [bookId], references: [id])
  bookId      String
  user        User               @relation("UserReservations", fields: [userId], references: [id])
  userId      String
  reservedAt  DateTime
  expiresAt   DateTime
  status      ReservationStatus  @default(PENDING)
  
  @@index([userId])
  @@index([bookId])
}

model Notification {
  id        String            @id @default(cuid())
  user      User              @relation("UserNotifications", fields: [userId], references: [id])
  userId    String
  type      NotificationType
  message   String
  read      Boolean           @default(false)
  createdAt DateTime          @default(now())
  
  @@index([userId])
}
